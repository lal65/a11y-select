let unique_ids=[],a11ySelect=(t,l)=>{if(-1<unique_ids.indexOf(l))return void console.error('The a11y-select progressive enhancement was not applied due to an ID collision ("'+l+'"). Ensure that all calls to a11ySelect use a distinct "unique_id" parameter.');unique_ids.push(l);var e="MacIntel"===navigator.platform;if(e&&"Apple Computer, Inc."===navigator.vendor)return void console.info("The a11y-select progressive enhancement was not applied due to an incompatible user-agent.  The combobox pattern is not accessible in macOS 14 or earlier and Apple does not allow for operating system version detection via javascript.");if("select"!==t?.tagName?.toLowerCase())return void console.error('Skipping a11y-select progressive enhancement for "'+l+'" due to incorrect element type.');if(t.hasAttribute("multiple"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "multiple" attribute.');if(t.hasAttribute("disabled"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "disabled" attribute.');let a=t.closest("label");if(!(a=!a&&t.hasAttribute("id")?document.querySelector('label[for="'+t.getAttribute("id")+'"]'):a))return void console.error("Skipping a11y-select progressive enhancement due to lack of accessible label.");e&&t.querySelector("optgroup")&&console.warn("Option groups are not well supported on MacOS / Voiceover. Instead of using option groups, consider a different user experience."),t.querySelector("[disabled]")&&console.warn("One or more disabled options were found. Disabled options will not be transformed. Consider adjusting the options to not include disabled ones.");let i=Object.assign(document.createElement("div"),{className:"a11y-select"}),r=(t.insertAdjacentElement("afterend",i),i.appendChild(t),Object.assign(document.createElement("div"),{className:"a11y-select__combobox",tabIndex:"0",ariaHasPopup:"listbox",role:"combobox",ariaExpanded:"false"})),d=(r.setAttribute("aria-controls",`a11y-select-${l}--listbox`),a.hasAttribute("id")||a.setAttribute("id",`a11y-select-${l}--combobox-label`),r.setAttribute("aria-labelledby",a.getAttribute("id")),t.hasAttribute("aria-describedby")&&r.setAttribute("aria-describedby",t.getAttribute("aria-describedby")),a.addEventListener("click",()=>{r.focus()}),r.addEventListener("click",()=>{"true"===r.getAttribute("aria-expanded")?f(!1):g()}),Object.assign(document.createElement("div"),{className:"a11y-select__listbox",id:`a11y-select-${l}--listbox`,role:"listbox",tabIndex:"-1"}));function n(){t.hasAttribute("required")?r.setAttribute("aria-required","true"):r.removeAttribute("aria-required"),c=[],d.innerHTML="";let n=0,o=0;function s(e,t,a){let i=Object.assign(document.createElement("div"),{className:"a11y-select__option"+(e.hasAttribute("selected")?" a11y-select__option--selected":""),id:`a11y-select-${l}--option-`+a,role:"option",tabIndex:"-1",ariaSelected:e.hasAttribute("selected")?"true":"false",textContent:e.textContent});i.setAttribute("data-native-option-value",e.getAttribute("value")),i.addEventListener("click",e=>{e.preventDefault(),b=i,f(!0)}),c.push(i),t.appendChild(i)}t.querySelectorAll(":scope > option:not([disabled]), :scope > optgroup:not([disabled])").forEach(e=>{if("optgroup"===e.tagName.toLowerCase()){var a=e;var i=++n;var r=Object.assign(document.createElement("div"),{className:"a11y-select__group-label",role:"presentation",tabindex:"-1",id:`a11y-select-${l}--optgroup-`+i,textContent:a.getAttribute("label")});let t=Object.assign(document.createElement("div"),{className:"a11y-select__group",role:"group"});t.appendChild(r),t.setAttribute("aria-labelledby",`a11y-select-${l}--optgroup-`+i),a.querySelectorAll("option:not([disabled])").forEach(e=>{s(e,t,++o)}),d.appendChild(t)}else s(e,d,++o)}),b=u=p=d.querySelector('[aria-selected="true"]')??c[0],p?.setAttribute("aria-selected","true"),p?.classList.add("a11y-select__option--selected"),r.textContent=p?.textContent}let c=[],u=null,p=null,b=null,o="",s=null;function v(){var{offsetHeight:e,offsetTop:t}=b,{offsetHeight:a,scrollTop:i}=d,r=i+a<t+e;t<i?d.scrollTo(0,t):r&&d.scrollTo(0,t-a+e)}function g(){r.setAttribute("aria-expanded","true"),m()}function f(e){r.setAttribute("aria-expanded","false"),e?u!==b&&(u=p=b,y.disconnect(),t.value=p.getAttribute("data-native-option-value"),t.dispatchEvent(new Event("change")),"true"!==r.getAttribute("aria-required")||u.getAttribute("data-native-option-value")?"true"===r.getAttribute("aria-invalid")&&r.setAttribute("aria-invalid","false"):r.setAttribute("aria-invalid","true"),y.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})):p=u,m(),r.removeAttribute("aria-activedescendant")}function m(){r.setAttribute("aria-busy","true"),r.removeAttribute("aria-activedescendant"),d.querySelector('[aria-selected="true"]')?.setAttribute("aria-selected","false"),d.querySelector(".a11y-select__option--selected")?.classList.remove("a11y-select__option--selected"),d.querySelector(".a11y-select__option--active-descendant")?.classList.remove("a11y-select__option--active-descendant"),p?.setAttribute("aria-selected","true"),p?.classList.add("a11y-select__option--selected"),b?.classList.add("a11y-select__option--active-descendant"),b&&r.setAttribute("aria-activedescendant",b.getAttribute("id")),r.textContent=p.textContent,r.removeAttribute("aria-busy")}r.addEventListener("focusout",e=>{"true"!==r.getAttribute("aria-expanded")||r.nextElementSibling.contains(e.relatedTarget)||f(!1)}),r.addEventListener("keydown",e=>{"Tab"===e.key?(p=b,f(!0)):"Escape"===e.key?f(!1):"Enter"===e.key||" "===e.key?"true"===r.getAttribute("aria-expanded")?f(!0):g():"Home"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),b=c[0],m(),v()):"PageUp"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),b=c[Math.max(0,c.indexOf(b)-10)],m(),v(b,d)):"ArrowUp"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(b=c[Math.max(0,c.indexOf(b)-1)]),g):(b=c[Math.max(0,c.indexOf(b)-1)],m))(),v(b,d)):"ArrowDown"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(b=c[Math.min(c.indexOf(b)+1,c.length-1)]),g):(b=c[Math.min(c.indexOf(b)+1,c.length-1)],m))(),v(b,d)):"PageDown"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),b=c[Math.min(c.indexOf(b)+10,c.length-1)],m(),v(b,d)):"End"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),b=c[c.length-1],m(),v()):1===e.key.length&&("false"===r.getAttribute("aria-expanded")&&g(),null!==s&&clearTimeout(s),s=setTimeout(()=>{o="",s=null},500),o+=e.key,(e=c.filter(e=>0===e.textContent.toLowerCase().indexOf(o))).length&&(b=e[0],v()),m())});let y=new MutationObserver(function(){console.warn("The native select has been modified. Users may find this confusing."),y.disconnect(),n(),y.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})});n(),requestAnimationFrame(()=>{i.appendChild(r),i.appendChild(d),y.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})})};export{a11ySelect};