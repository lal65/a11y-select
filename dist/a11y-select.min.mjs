let unique_ids=[],a11ySelect=(r,l)=>{if(-1<unique_ids.indexOf(l))return void console.error('The a11y-select progressive enhancement was not applied due to an ID collision ("'+l+'"). Ensure that all calls to a11ySelect use a distinct "unique_id" parameter.');unique_ids.push(l);var e="MacIntel"===navigator.platform;if(e&&"Apple Computer, Inc."===navigator.vendor)return void console.info("The a11y-select progressive enhancement was not applied due to an incompatible user-agent.  The combobox pattern is not accessible in macOS 14 or earlier and Apple does not allow for operating system version detection via javascript.");if("select"!==r?.tagName?.toLowerCase())return void console.error('Skipping a11y-select progressive enhancement for "'+l+'" due to incorrect element type.');if(r.hasAttribute("multiple"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "multiple" attribute.');if(r.hasAttribute("disabled"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "disabled" attribute.');let t=r.closest("label");if(!(t=!t&&r.hasAttribute("id")?document.querySelector('label[for="'+r.getAttribute("id")+'"]'):t))return void console.error("Skipping a11y-select progressive enhancement due to lack of accessible label.");e&&r.querySelector("optgroup")&&console.warn("Option groups are not well supported on MacOS / Voiceover. Instead of using option groups, consider a different user experience."),r.querySelector("[disabled]")&&console.warn("One or more disabled options were found. Disabled options will not be transformed. Consider adjusting the options to not include disabled ones.");let a=Object.assign(document.createElement("div"),{className:"a11y-select"}),i=(r.insertAdjacentElement("afterend",a),a.appendChild(r),Object.assign(document.createElement("div"),{className:"a11y-select__combobox",tabIndex:"0",ariaHasPopup:"listbox",role:"combobox",ariaExpanded:"false"})),d=(i.setAttribute("aria-controls",`a11y-select-${l}--listbox`),t.hasAttribute("id")||t.setAttribute("id",`a11y-select-${l}--combobox-label`),i.setAttribute("aria-labelledby",t.getAttribute("id")),r.hasAttribute("aria-describedby")&&i.setAttribute("aria-describedby",r.getAttribute("aria-describedby")),"true"===r.getAttribute("aria-invalid")&&i.setAttribute("aria-invalid","true"),t.addEventListener("click",()=>{i.focus()}),i.addEventListener("click",()=>{"true"===i.getAttribute("aria-expanded")?f(!1):g()}),Object.assign(document.createElement("div"),{className:"a11y-select__listbox",id:`a11y-select-${l}--listbox`,role:"listbox",tabIndex:"-1"}));function n(){r.hasAttribute("required")?i.setAttribute("aria-required","true"):i.removeAttribute("aria-required"),r.hasAttribute("aria-describedby")?i.setAttribute("aria-describedby",r.getAttribute("aria-describedby")):i.removeAttribute("aria-describedby")}function s(){c=[],d.innerHTML="";let n=0,s=0;function o(e,t,a){let i=Object.assign(document.createElement("div"),{className:"a11y-select__option"+(e.hasAttribute("selected")?" a11y-select__option--selected":""),id:`a11y-select-${l}--option-`+a,role:"option",tabIndex:"-1",ariaSelected:e.hasAttribute("selected")?"true":"false",textContent:e.textContent});i.setAttribute("data-native-option-value",e.getAttribute("value")),i.addEventListener("click",e=>{e.preventDefault(),p=i,f(!0)}),c.push(i),t.appendChild(i)}r.querySelectorAll(":scope > option:not([disabled]), :scope > optgroup:not([disabled])").forEach(e=>{if("optgroup"===e.tagName.toLowerCase()){var a=e;var i=++n;var r=Object.assign(document.createElement("div"),{className:"a11y-select__group-label",role:"presentation",tabindex:"-1",id:`a11y-select-${l}--optgroup-`+i,textContent:a.getAttribute("label")});let t=Object.assign(document.createElement("div"),{className:"a11y-select__group",role:"group"});t.appendChild(r),t.setAttribute("aria-labelledby",`a11y-select-${l}--optgroup-`+i),a.querySelectorAll("option:not([disabled])").forEach(e=>{o(e,t,++s)}),d.appendChild(t)}else o(e,d,++s)}),p=u=b=d.querySelector('[aria-selected="true"]')??c[0],b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),i.textContent=b?.textContent}let c=[],u=null,b=null,p=null,o="",v=null;function y(){var{offsetHeight:e,offsetTop:t}=p,{offsetHeight:a,scrollTop:i}=d,r=i+a<t+e;t<i?d.scrollTo(0,t):r&&d.scrollTo(0,t-a+e)}function g(){i.setAttribute("aria-expanded","true"),m()}function f(e){i.setAttribute("aria-expanded","false"),e?u!==p&&(u=b=p,A.disconnect(),r.value=b.getAttribute("data-native-option-value"),r.dispatchEvent(new Event("change")),r.checkValidity()?"true"===i.getAttribute("aria-invalid")&&i.setAttribute("aria-invalid","false"):i.setAttribute("aria-invalid","true"),A.observe(r,{attributes:!0,attributeFilter:["required","aria-describedby"],childList:!0,subtree:!0,characterData:!0})):(i.hasAttribute("aria-invalid")&&!r.checkValidity()&&i.setAttribute("aria-invalid","true"),p=b=u),m(),i.removeAttribute("aria-activedescendant")}function m(){i.setAttribute("aria-busy","true"),i.removeAttribute("aria-activedescendant"),d.querySelector('[aria-selected="true"]')?.setAttribute("aria-selected","false"),d.querySelector(".a11y-select__option--selected")?.classList.remove("a11y-select__option--selected"),d.querySelector(".a11y-select__option--active-descendant")?.classList.remove("a11y-select__option--active-descendant"),b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),p?.classList.add("a11y-select__option--active-descendant"),p&&i.setAttribute("aria-activedescendant",p.getAttribute("id")),i.textContent=b.textContent,i.removeAttribute("aria-busy")}i.addEventListener("focusout",e=>{"true"!==i.getAttribute("aria-expanded")||i.nextElementSibling.contains(e.relatedTarget)||f(!1),i.setAttribute("aria-invalid",r.checkValidity()?"false":"true")}),i.addEventListener("keydown",e=>{"Tab"===e.key?(b=p,f(!0)):"Escape"===e.key?f(!1):"Enter"===e.key||" "===e.key?"true"===i.getAttribute("aria-expanded")?f(!0):g():"Home"===e.key?"true"===i.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[0],m(),y()):"PageUp"===e.key?"true"===i.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[Math.max(0,c.indexOf(p)-10)],m(),y(p,d)):"ArrowUp"===e.key?(e.preventDefault(),("false"===i.getAttribute("aria-expanded")?(e.altKey||(p=c[Math.max(0,c.indexOf(p)-1)]),g):(p=c[Math.max(0,c.indexOf(p)-1)],m))(),y(p,d)):"ArrowDown"===e.key?(e.preventDefault(),("false"===i.getAttribute("aria-expanded")?(e.altKey||(p=c[Math.min(c.indexOf(p)+1,c.length-1)]),g):(p=c[Math.min(c.indexOf(p)+1,c.length-1)],m))(),y(p,d)):"PageDown"===e.key?"true"===i.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[Math.min(c.indexOf(p)+10,c.length-1)],m(),y(p,d)):"End"===e.key?"true"===i.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[c.length-1],m(),y()):1===e.key.length&&("false"===i.getAttribute("aria-expanded")&&g(),null!==v&&clearTimeout(v),v=setTimeout(()=>{o="",v=null},500),o+=e.key,(e=c.filter(e=>0===e.textContent.toLowerCase().indexOf(o))).length&&(p=e[0],y()),m())});let A=new MutationObserver(function(e){A.disconnect();let t=!1,a=!1;for(var i of e)t||"attributes"!==i.type?a||(console.warn("The native select has been modified. Users may find this confusing."),s(),a=!0):(n(),t=!0);A.observe(r,{attributes:!0,attributeFilter:["required","aria-describedby"],childList:!0,subtree:!0,characterData:!0})});n(),s(),requestAnimationFrame(()=>{a.appendChild(i),a.appendChild(d),A.observe(r,{attributes:!0,attributeFilter:["required","aria-describedby"],childList:!0,subtree:!0,characterData:!0})})};export{a11ySelect};