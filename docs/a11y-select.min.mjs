let unique_ids=[],a11ySelect=(t,l)=>{if(-1<unique_ids.indexOf(l))return void console.error('The a11y-select progressive enhancement was not applied due to an ID collision ("'+l+'"). Ensure that all calls to a11ySelect use a distinct "unique_id" parameter.');unique_ids.push(l);var e="MacIntel"===navigator.platform;if(e&&"Apple Computer, Inc."===navigator.vendor)return void console.info("The a11y-select progressive enhancement was not applied due to an incompatible user-agent.  The combobox pattern is not accessible in macOS 14 or earlier and Apple does not allow for operating system version detection via javascript.");if("select"!==t?.tagName?.toLowerCase())return void console.error('Skipping a11y-select progressive enhancement for "'+l+'" due to incorrect element type.');if(t.hasAttribute("multiple"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "multiple" attribute.');if(t.hasAttribute("disabled"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "disabled" attribute.');let a=t.closest("label");if(!(a=!a&&t.hasAttribute("id")?document.querySelector('label[for="'+t.getAttribute("id")+'"]'):a))return void console.error("Skipping a11y-select progressive enhancement due to lack of accessible label.");e&&t.querySelector("optgroup")&&console.warn("Option groups are not well supported on MacOS / Voiceover. Instead of using option groups, consider a different user experience."),t.querySelector("[disabled]")&&console.warn("One or more disabled options were found. Disabled options will not be transformed. Consider adjusting the options to not include disabled ones.");let i=Object.assign(document.createElement("div"),{className:"a11y-select"}),r=(t.insertAdjacentElement("afterend",i),i.appendChild(t),Object.assign(document.createElement("div"),{className:"a11y-select__combobox",tabIndex:"0",ariaHasPopup:"listbox",role:"combobox",ariaExpanded:"false"})),d=(r.setAttribute("aria-controls",`a11y-select-${l}--listbox`),a.hasAttribute("id")||a.setAttribute("id",`a11y-select-${l}--combobox-label`),r.setAttribute("aria-labelledby",a.getAttribute("id")),t.hasAttribute("aria-describedby")&&r.setAttribute("aria-describedby",t.getAttribute("aria-describedby")),a.addEventListener("click",()=>{r.focus()}),r.addEventListener("click",()=>{"true"===r.getAttribute("aria-expanded")?(r.setAttribute("aria-expanded","false"),r.removeAttribute("aria-activedescendant")):r.setAttribute("aria-expanded","true")}),Object.assign(document.createElement("div"),{className:"a11y-select__value"})),c=(r.appendChild(d),Object.assign(document.createElement("div"),{className:"a11y-select__listbox",id:`a11y-select-${l}--listbox`,role:"listbox",tabIndex:"-1"}));function n(){t.hasAttribute("required")?r.setAttribute("aria-required","true"):r.removeAttribute("aria-required"),u=[],c.innerHTML="";let n=0,s=0;function o(e,t,a){let i=Object.assign(document.createElement("div"),{className:"a11y-select__option"+(e.hasAttribute("selected")?" a11y-select__option--selected":""),id:`a11y-select-${l}--option-`+a,role:"option",tabIndex:"-1",ariaSelected:e.hasAttribute("selected")?"true":"false",textContent:e.textContent});i.setAttribute("data-native-option-value",e.getAttribute("value")),i.addEventListener("click",e=>{e.preventDefault(),v=i,y(!0)}),u.push(i),t.appendChild(i)}t.querySelectorAll(":scope > option:not([disabled]), :scope > optgroup:not([disabled])").forEach(e=>{if("optgroup"===e.tagName.toLowerCase()){var a=e;var i=++n;var r=Object.assign(document.createElement("div"),{className:"a11y-select__group-accessible-name",role:"presentation",tabindex:"-1",id:`a11y-select-${l}--optgroup-`+i,textContent:a.getAttribute("label")});let t=Object.assign(document.createElement("div"),{className:"a11y-select__group",role:"group"});t.appendChild(r),t.setAttribute("aria-labelledby",`a11y-select-${l}--optgroup-`+i),a.querySelectorAll("option:not([disabled])").forEach(e=>{o(e,t,++s)}),c.appendChild(t)}else o(e,c,++s)}),v=p=b=c.querySelector('[aria-selected="true"]')??u[0],b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),d.textContent=b?.textContent}let u=[],p=null,b=null,v=null,s="",o=null;function g(){var{offsetHeight:e,offsetTop:t}=v,{offsetHeight:a,scrollTop:i}=c,r=i+a<t+e;t<i?c.scrollTo(0,t):r&&c.scrollTo(0,t-a+e)}function m(){r.setAttribute("aria-expanded","true"),f()}function y(e){r.setAttribute("aria-expanded","false"),e?p!==v&&(p=b=v,A.disconnect(),t.value=b.getAttribute("data-native-option-value"),t.dispatchEvent(new Event("change")),"true"!==r.getAttribute("aria-required")||p.getAttribute("data-native-option-value")?"true"===r.getAttribute("aria-invalid")&&r.setAttribute("aria-invalid","false"):r.setAttribute("aria-invalid","true"),A.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})):b=p,f(),r.removeAttribute("aria-activedescendant")}function f(){r.setAttribute("aria-busy","true"),r.removeAttribute("aria-activedescendant"),c.querySelector('[aria-selected="true"]')?.setAttribute("aria-selected","false"),c.querySelector(".a11y-select__option--selected")?.classList.remove("a11y-select__option--selected"),c.querySelector(".a11y-select__option--active-descendant")?.classList.remove("a11y-select__option--active-descendant"),b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),v?.classList.add("a11y-select__option--active-descendant"),v&&r.setAttribute("aria-activedescendant",v.getAttribute("id")),d.textContent=b.textContent,r.removeAttribute("aria-busy")}r.addEventListener("focusout",e=>{"true"!==r.getAttribute("aria-expanded")||r.nextElementSibling.contains(e.relatedTarget)||y(!1)}),r.addEventListener("keydown",e=>{"Tab"===e.key?(b=v,y(!0)):"Escape"===e.key?y(!1):"Enter"===e.key||" "===e.key?"true"===r.getAttribute("aria-expanded")?y(!0):m():"Home"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),v=u[0],f(),g()):"PageUp"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),v=u[Math.max(0,u.indexOf(v)-10)],f(),g(v,c)):"ArrowUp"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(v=u[Math.max(0,u.indexOf(v)-1)]),m):(v=u[Math.max(0,u.indexOf(v)-1)],f))(),g(v,c)):"ArrowDown"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(v=u[Math.min(u.indexOf(v)+1,u.length-1)]),m):(v=u[Math.min(u.indexOf(v)+1,u.length-1)],f))(),g(v,c)):"PageDown"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),v=u[Math.min(u.indexOf(v)+10,u.length-1)],f(),g(v,c)):"End"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),v=u[u.length-1],f(),g()):1===e.key.length&&("false"===r.getAttribute("aria-expanded")&&m(),null!==o&&clearTimeout(o),o=setTimeout(()=>{s="",o=null},500),s+=e.key,(e=u.filter(e=>0===e.textContent.toLowerCase().indexOf(s))).length&&(v=e[0],g()),f())});let A=new MutationObserver(function(){console.warn("The native select has been modified. Users may find this confusing."),A.disconnect(),n(),A.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})});n(),requestAnimationFrame(()=>{t.style.display="none",i.appendChild(r),i.appendChild(c),A.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0})})};export{a11ySelect};