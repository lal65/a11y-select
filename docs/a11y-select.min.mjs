let unique_ids=[],a11ySelect=(i,l)=>{if(-1<unique_ids.indexOf(l))return void console.error('The a11y-select progressive enhancement was not applied due to an ID collision ("'+l+'"). Ensure that all calls to a11ySelect use a distinct "unique_id" parameter.');unique_ids.push(l);var e="MacIntel"===navigator.platform;if(e&&"Apple Computer, Inc."===navigator.vendor)return void console.info("The a11y-select progressive enhancement was not applied due to an incompatible user-agent.  The combobox pattern is not accessible in macOS 14 or earlier and Apple does not allow for operating system version detection via javascript.");if("select"!==i?.tagName?.toLowerCase())return void console.error('Skipping a11y-select progressive enhancement for "'+l+'" due to incorrect element type.');if(i.hasAttribute("multiple"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "multiple" attribute.');if(i.hasAttribute("disabled"))return void console.error('Skipping a11y-select progressive enhancement due to unsupported "disabled" attribute.');let t=i.closest("label");if(!(t=!t&&i.hasAttribute("id")?document.querySelector('label[for="'+i.getAttribute("id")+'"]'):t))return void console.error("Skipping a11y-select progressive enhancement due to lack of accessible label.");e&&i.querySelector("optgroup")&&console.warn("Option groups are not well supported on MacOS / Voiceover. Instead of using option groups, consider a different user experience."),i.querySelector("[disabled]")&&console.warn("One or more disabled options were found. Disabled options will not be transformed. Consider adjusting the options to not include disabled ones.");let a=Object.assign(document.createElement("div"),{className:"a11y-select"}),r=(i.insertAdjacentElement("afterend",a),a.appendChild(i),Object.assign(document.createElement("div"),{className:"a11y-select__combobox",tabIndex:"0",ariaHasPopup:"listbox",role:"combobox",ariaExpanded:"false"})),d=(r.setAttribute("aria-controls",`a11y-select-${l}--listbox`),t.hasAttribute("id")||t.setAttribute("id",`a11y-select-${l}--combobox-label`),r.setAttribute("aria-labelledby",t.getAttribute("id")),i.hasAttribute("aria-describedby")&&r.setAttribute("aria-describedby",i.getAttribute("aria-describedby")),t.addEventListener("click",()=>{r.focus()}),r.addEventListener("click",()=>{"true"===r.getAttribute("aria-expanded")?y(!1):g()}),Object.assign(document.createElement("div"),{className:"a11y-select__listbox",id:`a11y-select-${l}--listbox`,role:"listbox",tabIndex:"-1"}));function n(){i.hasAttribute("required")?r.setAttribute("aria-required","true"):r.removeAttribute("aria-required")}function o(){c=[],d.innerHTML="";let n=0,o=0;function s(e,t,a){let i=Object.assign(document.createElement("div"),{className:"a11y-select__option"+(e.hasAttribute("selected")?" a11y-select__option--selected":""),id:`a11y-select-${l}--option-`+a,role:"option",tabIndex:"-1",ariaSelected:e.hasAttribute("selected")?"true":"false",textContent:e.textContent});i.setAttribute("data-native-option-value",e.getAttribute("value")),i.addEventListener("click",e=>{e.preventDefault(),p=i,y(!0)}),c.push(i),t.appendChild(i)}i.querySelectorAll(":scope > option:not([disabled]), :scope > optgroup:not([disabled])").forEach(e=>{if("optgroup"===e.tagName.toLowerCase()){var a=e;var i=++n;var r=Object.assign(document.createElement("div"),{className:"a11y-select__group-label",role:"presentation",tabindex:"-1",id:`a11y-select-${l}--optgroup-`+i,textContent:a.getAttribute("label")});let t=Object.assign(document.createElement("div"),{className:"a11y-select__group",role:"group"});t.appendChild(r),t.setAttribute("aria-labelledby",`a11y-select-${l}--optgroup-`+i),a.querySelectorAll("option:not([disabled])").forEach(e=>{s(e,t,++o)}),d.appendChild(t)}else s(e,d,++o)}),p=u=b=d.querySelector('[aria-selected="true"]')??c[0],b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),r.textContent=b?.textContent}let c=[],u=null,b=null,p=null,s="",v=null;function f(){var{offsetHeight:e,offsetTop:t}=p,{offsetHeight:a,scrollTop:i}=d,r=i+a<t+e;t<i?d.scrollTo(0,t):r&&d.scrollTo(0,t-a+e)}function g(){r.setAttribute("aria-expanded","true"),m()}function y(e){r.setAttribute("aria-expanded","false"),e?u!==p&&(u=b=p,h.disconnect(),i.value=b.getAttribute("data-native-option-value"),i.dispatchEvent(new Event("change")),i.checkValidity()?"true"===r.getAttribute("aria-invalid")&&r.setAttribute("aria-invalid","false"):r.setAttribute("aria-invalid","true"),h.observe(i,{attributes:!0,attributeFilter:["required"],childList:!0,subtree:!0,characterData:!0})):(r.hasAttribute("aria-invalid")&&!i.checkValidity()&&r.setAttribute("aria-invalid","true"),p=b=u),m(),r.removeAttribute("aria-activedescendant")}function m(){r.setAttribute("aria-busy","true"),r.removeAttribute("aria-activedescendant"),d.querySelector('[aria-selected="true"]')?.setAttribute("aria-selected","false"),d.querySelector(".a11y-select__option--selected")?.classList.remove("a11y-select__option--selected"),d.querySelector(".a11y-select__option--active-descendant")?.classList.remove("a11y-select__option--active-descendant"),b?.setAttribute("aria-selected","true"),b?.classList.add("a11y-select__option--selected"),p?.classList.add("a11y-select__option--active-descendant"),p&&r.setAttribute("aria-activedescendant",p.getAttribute("id")),r.textContent=b.textContent,r.removeAttribute("aria-busy")}r.addEventListener("focusout",e=>{"true"!==r.getAttribute("aria-expanded")||r.nextElementSibling.contains(e.relatedTarget)||y(!1)}),r.addEventListener("keydown",e=>{"Tab"===e.key?(b=p,y(!0)):"Escape"===e.key?y(!1):"Enter"===e.key||" "===e.key?"true"===r.getAttribute("aria-expanded")?y(!0):g():"Home"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[0],m(),f()):"PageUp"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[Math.max(0,c.indexOf(p)-10)],m(),f(p,d)):"ArrowUp"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(p=c[Math.max(0,c.indexOf(p)-1)]),g):(p=c[Math.max(0,c.indexOf(p)-1)],m))(),f(p,d)):"ArrowDown"===e.key?(e.preventDefault(),("false"===r.getAttribute("aria-expanded")?(e.altKey||(p=c[Math.min(c.indexOf(p)+1,c.length-1)]),g):(p=c[Math.min(c.indexOf(p)+1,c.length-1)],m))(),f(p,d)):"PageDown"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[Math.min(c.indexOf(p)+10,c.length-1)],m(),f(p,d)):"End"===e.key?"true"===r.getAttribute("aria-expanded")&&(e.preventDefault(),p=c[c.length-1],m(),f()):1===e.key.length&&("false"===r.getAttribute("aria-expanded")&&g(),null!==v&&clearTimeout(v),v=setTimeout(()=>{s="",v=null},500),s+=e.key,(e=c.filter(e=>0===e.textContent.toLowerCase().indexOf(s))).length&&(p=e[0],f()),m())});let h=new MutationObserver(function(e){h.disconnect();let t=!1;for(var a of e)t||"attributes"!==a.type?(console.warn("The native select has been modified. Users may find this confusing."),o()):(n(),t=!0);h.observe(i,{attributes:!0,attributeFilter:["required"],childList:!0,subtree:!0,characterData:!0})});n(),o(),requestAnimationFrame(()=>{a.appendChild(r),a.appendChild(d),h.observe(i,{attributes:!0,attributeFilter:["required"],childList:!0,subtree:!0,characterData:!0})})};export{a11ySelect};